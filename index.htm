<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Portone</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="olliout.css">
    <link rel="stylesheet" href="loader.css">
</head>

<body style="background-color: greenyellow;">
    <div class="container">
        <div class="inner-container">
            <br>
            <!-- Welcome card -->
            <div class="card text-center">
                <div class="card-body bg-transparent">
                    <h4 class="card-title">PortoNet</h4>
                    <p class="card-text">Inserisci la chiave di accesso</p>
                    <p class="card-text" id="count"></p>
                    <a href="http://vabbuo.it" class="mt-2 btn btn-success" title="Vabbuò dai guardati ancora due frasi">vabbuo.it</a>
                    <a href="http://olimexsmart.it" class="mt-2 btn btn-primary" title="Scopri tutta la storia, in inglese">olimexsmart.it</a>
                    <a href="/admin.htm" class="mt-2 btn btn-danger" title="Smanetta">Amministrazione</a>
                </div>
            </div>

            <br>

            <form id="access" method="post">
                <!-- Text inputs -->
                <div class="form-group row">
                    <label for="k" class="mt-2 col-sm-2 col-form-label">
                        <b>Password</b>
                    </label>
                    <div class="mt-2 col-sm-10">
                        <input type="password" class="form-control" name="k" id="key" placeholder="Dai eh" title="Mi raccomando">
                    </div>
                    <div class="mt-5 col-sm-12 text-center">
                        <button type="button" class="btn btn-success btn-lg btn-block" title="Daje" id="submit">Fai un tentativo</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal open -->
    <div class="modal fade" id="open" tabindex="-1" role="dialog" aria-labelledby="thanksLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thanksLabel">Ma che bravo!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Vieni su, a pra foco caro!
                </div>
                <div class="modal-footer">
                    <a href="http://vabbuo.it" class="mt-2 btn btn-success" title="Vabbuò dai guardati ancora due frasi">Dai entra</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal locked -->
    <div class="modal fade" id="locked" tabindex="-1" role="dialog" aria-labelledby="thanksLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thanksLabel">Sistema bloccato!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Chiama Olli che te lo sblocca
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" data-dismiss="modal">Sbatti</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal forbidden -->
    <div class="modal fade" id="forbidden" tabindex="-1" role="dialog" aria-labelledby="thanksLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thanksLabel">Ahia!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Guarda un po' meglio perché hai scritto qualcosa di sbagliato
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Riprova</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal tooMany -->
    <div class="modal fade" id="tooMany" tabindex="-1" role="dialog" aria-labelledby="thanksLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thanksLabel">Malissimo!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Le credenziali sono state sbagliate troppe volte, devi aspettare un po' di tempo prima di riprovare
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Aspetterò</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal generic -->
    <div class="modal fade" id="default" tabindex="-1" role="dialog" aria-labelledby="thanksLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thanksLabel">Boh?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Qualcosa è andato storto ma non saprei cosa
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Vabbuò</button>
                </div>
            </div>
        </div>
    </div>


    <div id="loader"></div>

    <!-- <script src="index.js"></script> -->
    <script>
        $(function () {
            $('#submit').click(function () {
                $.ajax({	// Send request
                    url: "login.ard",
                    method: "POST",
                    dataType: "text",
                    data: $('#access').serialize(),
                    timeout: 10000,
                    success: function (result) {
                        $('#loader').hide();
                        $('#open').modal();
                    },
                    error: function (result) {
                        $('#loader').hide();
                        switch (result.status) {
                            case 423:
                                $('#locked').modal();
                                break;
                            case 403:
                                $('#forbidden').modal();
                                break;
                            case 429:
                                $('#tooMany').modal();
                                break;
                            default:
                                $('#default').modal();
                                break;
                        }
                    }
                });
                //alert("Sent");                
                $('#loader').show();
            });

            $.ajax({
                url: "count.ard",
                method: "GET",
                dataType: "text",
                timeout: 10000,
                success: function (result) {
                    $('#count').text("Succesful openings: " + result);
                }
            });
        })        
    </script>
</body>

</html>